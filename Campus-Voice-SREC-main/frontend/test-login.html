<!DOCTYPE html>
<html>
<head>
    <title>Test Login Flow</title>
</head>
<body>
    <h1>Login Debug Test</h1>
    <button onclick="checkAuth()">Check Auth State</button>
    <button onclick="clearAuth()">Clear Auth</button>
    <pre id="output"></pre>
    
    <script>
        function checkAuth() {
            const output = document.getElementById('output');
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            let result = 'Token: ' + (token ? 'EXISTS' : 'MISSING') + '\n';
            result += 'Token value: ' + (token || 'null') + '\n\n';
            result += 'User: ' + (user ? 'EXISTS' : 'MISSING') + '\n';
            result += 'User value: ' + (user || 'null') + '\n\n';
            
            if (token) {
                try {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(
                        atob(base64)
                            .split('')
                            .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
                            .join('')
                    );
                    const decoded = JSON.parse(jsonPayload);
                    result += 'Decoded Token:\n' + JSON.stringify(decoded, null, 2);
                } catch (e) {
                    result += 'Error decoding token: ' + e.message;
                }
            }
            
            if (user) {
                try {
                    const userObj = JSON.parse(user);
                    result += '\n\nParsed User:\n' + JSON.stringify(userObj, null, 2);
                } catch (e) {
                    result += '\n\nError parsing user: ' + e.message;
                }
            }
            
            output.textContent = result;
        }
        
        function clearAuth() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            alert('Auth cleared. Refresh the page.');
        }
    </script>
</body>
</html>
